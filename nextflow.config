params {
    // Profile info
    config_profile_description = 'Alliance HPC config'
    config_profile_contact = 'https://docs.alliancecan.ca/wiki/Technical_support'
    config_profile_url = 'docs.alliancecan.ca/wiki/Nextflow'

    // Base directory (user should set this)
    base_dir = "$projectDir"

    // Input/output paths
    data_dir = "${base_dir}/data"
    output_dir = "${base_dir}/results"
    bin_dir = "${base_dir}/bin"

    // Reference files
    ref_ld_chr = "${data_dir}/ld_reference/g1000_eur/g1000_eur"
    w_ld_chr = "${data_dir}/ld_reference/eur_w_ld_chr"
    hapmap_ref = "${data_dir}/ld_reference/w_hm3.snplist"
    locus_file = "${data_dir}/ld_reference/blocks_s2500_EUR_chr1-23full.GRCh37_hg19.locfile"

    // Containers
    ldsc_container = "${bin_dir}/ldsc_latest.sif"
}

apptainer {
  enabled = true
  autoMounts = true
  runOptions = "-B ${params.data_dir}/ld_reference/ \
                -B ${params.output_dir}/"
}

process {
  executor = 'slurm' 
  clusterOptions = '--account=def-xxxxx' // User needs to set the account
  maxRetries = 1
  errorStrategy = { task.exitStatus in [125,139] ? 'retry' : 'finish' }
  // memory = { check_max( 4.GB * task.attempt, 'memory' ) }
  memory = 10G
  cpus = 5  
  time = "1h"

  withLabel: ldsc {
    container = "file://${params.ldsc_container}"
  }

  withLabel: lava {
    memory = 10G
    time = "23h"
    cpus = 5
  }

}

executor {
  pollInterval = '60 sec'
  submitRateLimit = '60/1min'
  queueSize = 100 
}

profiles {
  beluga {
    max_memory='186G'
    max_cpu=40
    max_time='168h'
  }
  narval {
    max_memory='249G'
    max_cpu=64
    max_time='168h'
  }
}
